/*!
 * @form-create/core v1.0.19
 * (c) 2018-2020 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
import Vue from"vue";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $set(e,t,n){Vue.set(e,t,n)}function $del(e,t){Vue.delete(e,t)}var _extends=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&$set(e,r,t[r]);return e};function extend(){return _extends.apply(this,arguments)}var is={type:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},Undef:function(e){return null==e},Element:function(e){return"object"===_typeof(e)&&null!==e&&1===e.nodeType&&!is.Object(e)},trueArray:function(e){return Array.isArray(e)&&e.length>0}};function hasProperty(e,t){return{}.hasOwnProperty.call(e,t)}["Date","Object","Function","String","Boolean"," Array","Number"].forEach((function(e){is[e]=function(t){return is.type(t,e)}}));var NAME="FormCreate";function $FormCreate(e){return{name:NAME,componentName:NAME,model:{prop:"api"},props:{rule:{type:Array,required:!0},option:{type:Object,default:function(){return{}}},value:Object,api:Object},data:function(){return{formData:void 0,$f:void 0,isShow:!0,unique:1,renderRule:_toConsumableArray(this.rule||[]),updateValue:""}},render:function(){return this.formCreate.render()},methods:{_refresh:function(){++this.unique},_renderRule:function(){this.renderRule=_toConsumableArray(this.rule||[])},_updateValue:function(e){this._isDestroyed||(this.updateValue=JSON.stringify(e),this.$emit("update:value",e))}},watch:{value:{handler:function(e){JSON.stringify(e)!==this.updateValue&&this.$f.setValue(e)},deep:!0},option:function(e){this.formCreate.initOptions(e),this.$f.refresh()},rule:function(e){var t=this;e.length===this.renderRule.length&&e.every((function(e){return t.renderRule.indexOf(e)>-1}))||(this.formCreate.$handle.reloadRule(e),this._renderRule())}},beforeCreate:function(){var t=this,n=this.$options.propsData,r=n.rule,i=n.option,o=n.value;this.formCreate=new e(this,Vue.observable(r),Vue.observable(i)),o&&is.Object(o)&&this.formCreate.updateOptions({formData:o}),Object.keys(this.formCreate.prop).forEach((function(e){extend(t.$options[e],t.formCreate.prop[e])}))}}}var normalMerge=["attrs","props","domProps","scopedSlots"],toArrayMerge=["class","style","directives"],functionalMerge=["on","nativeOn"],mergeProps=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[].concat(normalMerge,_toConsumableArray(r.normal||[])),o=[].concat(toArrayMerge,_toConsumableArray(r.array||[])),a=[].concat(functionalMerge,_toConsumableArray(r.functional||[])),u=r.props||[];return t.reduce((function(t,n){for(var r in n)if(t[r])if(u.indexOf(r)>-1)t[r]=e([n[r]],t[r]);else if(i.indexOf(r)>-1)t[r]=_objectSpread2(_objectSpread2({},t[r]),n[r]);else if(o.indexOf(r)>-1){var c=t[r]instanceof Array?t[r]:[t[r]],s=n[r]instanceof Array?n[r]:[n[r]];t[r]=[].concat(_toConsumableArray(c),_toConsumableArray(s))}else if(a.indexOf(r)>-1)for(var f in n[r])if(t[r][f]){var l=t[r][f]instanceof Array?t[r][f]:[t[r][f]],d=n[r][f]instanceof Array?n[r][f]:[n[r][f]];t[r][f]=[].concat(_toConsumableArray(l),_toConsumableArray(d))}else t[r][f]=n[r][f];else if("hook"===r)for(var p in n[r])t[r][p]?t[r][p]=mergeFn(t[r][p],n[r][p]):t[r][p]=n[r][p];else t[r]=n[r];else i.indexOf(r)>-1||a.indexOf(r)>-1||u.indexOf(r)>-1?t[r]=_objectSpread2({},n[r]):o.indexOf(r)>-1?t[r]=n[r]instanceof Array?_toConsumableArray(n[r]):"object"===_typeof(n[r])?_objectSpread2({},n[r]):[n[r]]:t[r]=n[r];return t}),n)},mergeFn=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},keyAttrs=["type","slot","emitPrefix","value","name","title","native","info","hidden","inject","options","emit","link","prefix","suffix","update"],arrayAttrs=["validate","children","control","className"],normalAttrs=["col","effect","wrap"],attrs=[].concat(keyAttrs,_toConsumableArray(normalMerge),_toConsumableArray(toArrayMerge),_toConsumableArray(functionalMerge),arrayAttrs,normalAttrs),allAttrs=[].concat(_toConsumableArray(attrs),["ref","key"]);function deepExtend(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=!1;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var o=t[i];if((r=Array.isArray(o))||is.Object(o)){var a=void 0===e[i];if(r)r=!1,a&&$set(e,i,[]);else if(o._clone&&void 0!==n){if(!n){$set(e,i,o._clone());continue}o=o.getRule(),a&&$set(e,i,{})}else a&&$set(e,i,{});e[i]=deepExtend(e[i],o,n)}else $set(e,i,o)}return void 0!==n&&Array.isArray(e)?e.filter((function(e){return!e||!e.__ctrl})):e}function deepCopy(e){return deepExtend({},{value:e}).value}function format(e,t,n){return"[form-create ".concat(e,"]: ").concat(t)+(n?"\n\nrule: "+JSON.stringify(n.getRule?n.getRule():n):"")}function tip(e,t){console.warn(format("tip",e,t))}function err(e,t){console.error(format("err",e,t))}function logError(e){err(e.toString()),console.error(e)}var PREFIX="[[FORM-CREATE-PREFIX-",SUFFIX="-FORM-CREATE-SUFFIX]]";function toJson(e){return JSON.stringify(deepExtend([],e,!0),(function(e,t){if(!t||!0!==t._isVue){if("function"!=typeof t)return t;if(t.__inject&&(t=t.__origin),!t.__emit)return PREFIX+t+SUFFIX}}))}function makeFn(fn){return eval("(function(){return "+fn+" })()")}function parseJson(e,t){return JSON.parse(e,(function(e,n){if(is.Undef(n)||!n.indexOf)return n;try{if(n.indexOf(SUFFIX)>0&&0===n.indexOf(PREFIX))return makeFn(-1===(n=n.replace(SUFFIX,"").replace(PREFIX,"")).indexOf("function")&&0!==n.indexOf("(")?"function "+n:n);if(!t&&n.indexOf("function")>-1)return makeFn(n)}catch(e){return void err("解析失败:".concat(n))}return n}))}function enumerable(e,t){return{value:e,enumerable:!1,configurable:!1,writable:!!t}}function copyRule(e,t){return copyRules([e],t||!1)[0]}function copyRules(e,t){return deepExtend([],_toConsumableArray(e),t||!1)}function mergeRule(e,t){return mergeProps([t],e,{array:arrayAttrs,normal:normalAttrs}),e}function getRule(e){return is.Function(e.getRule)?e.getRule():e}function mergeGlobal(e,t){if(!e)return t;Object.keys(t||{}).forEach((function(n){mergeRule(e[n],t[n]||{})}))}function funcProxy(e,t){Object.defineProperties(e,Object.keys(t).reduce((function(e,n){return e[n]={get:function(){return t[n]()}},e}),{}))}function byCtx(e){return e.__fc__||(e.__origin__?e.__origin__.__fc__:null)}function invoke(e,t){try{t=e()}catch(e){logError(e)}return t}function debounce(e,t){var n=null;return function(){for(var r=this,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];null!==n&&clearTimeout(n),n=setTimeout((function(){return e.call.apply(e,[r].concat(o))}),t)}}function toString(e){return null==e?"":"object"===_typeof(e)?JSON.stringify(e,null,2):String(e)}function toLine(e){var t=e.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return 0===t.indexOf("-")&&(t=t.substr(1)),t}var id=0;function uniqueId(){return Math.random().toString(36).substr(3,3)+Number("".concat(Date.now()).concat(++id)).toString(36)}function baseRule(){return{props:{},on:{},validate:[],options:[],col:{},children:[],control:[],emit:[],link:[],hidden:!1,value:null}}function creatorFactory(e){return function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Creator(e,t,n,r,i)}}function creatorTypeFactory(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"type";return function(r,i,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=new Creator(e,r,i,o,a);return is.Function(t)?t(u):u.props(n,t),u}}function Creator(e,t,n,r,i){this._data=extend(baseRule(),{type:e,title:t,field:n,value:r,props:i||{}}),this.event=this.on}extend(Creator.prototype,{getRule:function(){return this._data},setProp:function(e,t){return $set(this._data,e,t),this},_clone:function(){var e=new this.constructor;return e._data=copyRule(this._data),e}}),attrs.forEach((function(e){Creator.prototype[e]=function(t){return mergeRule(this._data,_defineProperty({},e,arguments.length<2?t:_defineProperty({},t,arguments[1]))),this}}));var commonMaker=creatorFactory("");function create(e,t,n){var r=commonMaker("",t);return r._data.type=e,r._data.title=n,r}function createTmp(e,t,n,r){var i=commonMaker("",n);return i._data.type="template",i._data.template=e,i._data.title=r,i._data.vm=t,i}function makerFactory(){return{create:create,createTmp:createTmp,template:createTmp,factory:creatorFactory,typeFactory:creatorTypeFactory}}function Api(e){function t(t){return is.Undef(t)?t=e.fields():Array.isArray(t)||(t=[t]),t}function n(e){return deepCopy(e)}function r(n,r,i){t(n).forEach((function(t){var n=e.getCtx(t);n&&($set(n.rule,r,i),e.$render.clearCache(n))}))}function i(e,t){return Object.keys(e).reduce((function(n,r){return n[r]=t?e[r].origin:e[r].rule,n}),{})}function o(e,t){return is.Boolean(e)?e={show:e}:is.Undef(e)||is.Object(e)||(e={show:t}),e}var a={get config(){return e.options},get options(){return e.options},get form(){return e.form},get rule(){return e.rules},formData:function(r){return t(r).reduce((function(t,r){var i=e.fieldList[r];return i?(t[i.field]=n(i.rule.value),t):t}),{})},getValue:function(t){var r=e.fieldList[t];if(r)return n(r.rule.value)},coverValue:function(t){Object.keys(e.fieldList).forEach((function(n){var r=e.fieldList[n];if(!r)return e.appendData[n]=t[n];r.rule.value=hasProperty(t,n)?t[n]:void 0}))},setValue:function(t){var n=t;arguments.length>=2&&(n=_defineProperty({},t,arguments[1])),Object.keys(n).forEach((function(t){var r=e.fieldList[t];if(!r)return e.appendData[t]=n[t];r.rule.value=n[t]}))},removeField:function(t){var n=e.getCtx(t);if(n)return n.rm(),n.origin},removeRule:function(e){var t=e&&byCtx(e);if(t)return t.rm(),t.origin},destroy:function(){e.vm.$el.parentNode&&e.vm.$el.parentNode.removeChild(e.vm.$el),e.vm.$destroy()},fields:function(){return e.fields()},append:function(t,n,r){var i,o=Object.keys(e.fieldList),a=e.sortList.length;if(t.field&&o.indexOf(t.field)>-1)return err("".concat(t.field," 字段已存在"),t);var u=e.getCtx(n);u?r?(i=u.rule.children,a=u.rule.children.length):(a=u.root.indexOf(u.origin),i=u.root):i=e.rules,i.splice(a+1,0,t)},prepend:function(t,n,r){var i,o=Object.keys(e.fieldList),a=0;if(t.field&&o.indexOf(t.field)>-1)return err("".concat(t.field," 字段已存在"),t);var u=e.getCtx(n);u?r?i=u.rule.children:(a=u.root.indexOf(u.origin),i=u.root):i=e.rules,i.splice(a,0,t)},hidden:function(t,n){r(n,"hidden",!!t),e.refresh()},hiddenStatus:function(t){var n=e.getCtx(t);if(n)return!!n.rule.hidden},disabled:function(n,r){t(r).forEach((function(t){var r=e.fieldList[t];r&&$set(r.rule.props,"disabled",!!n)})),e.refresh()},model:function(t){return i(e.fieldList,t)},component:function(t){return i(e.customData,t)},bind:function(){return Object.defineProperties({},Object.keys(e.fieldList).reduce((function(t,n){var r=e.fieldList[n];return t[n]={get:function(){return r.rule.value},set:function(e){r.rule.value=e},enumerable:!0,configurable:!0},t}),{}))},submitBtnProps:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=o(e.options.submitBtn,!0);extend(n,t),e.options.submitBtn=n,a.refresh()},resetBtnProps:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=o(e.options.resetProps,!1);extend(n,t),e.options.resetProps=n,a.refresh()},reload:function(t){e.reloadRule(t)},updateOptions:function(t){e.fc.updateOptions(t),a.refreshOptions()},onSubmit:function(e){this.updateOptions({onSubmit:e})},sync:function(t){var n=is.Object(t)?byCtx(t):e.getCtx(t);n&&(n.updateKey(!0),e.$render.clearCache(n),e.refresh())},refresh:function(t){e.$render.clearCacheAll(),t&&e.$manager.updateKey(),e.refresh()},refreshOptions:function(){e.$manager.updateOptions(e.options),this.refresh()},hideForm:function(t){$set(e.vm,"isShow",!t)},changeStatus:function(){return e.changeStatus},clearChangeStatus:function(){e.changeStatus=!1},updateRule:function(t,n){var r=e.getCtx(t);r&&mergeRule(r.rule,n)},getRule:function(t,n){var r=e.getCtx(t);if(r)return n?r.origin:r.rule},updateRules:function(e){var t=this;Object.keys(e).forEach((function(n){t.updateRule(n,e[n])}))},updateValidate:function(e,t,n){n?this.updateRule(e,{validate:t}):r(e,"validate",t)},updateValidates:function(e,t){var n=this;Object.keys(e).forEach((function(r){n.updateValidate(r,e[r],t)}))},method:function(e,t){var n=this.el(e);if(!n||!n[t])throw new Error(format("err","".concat(t,"方法不存在")));return function(){return n[t].apply(n,arguments)}},exec:function(e,t){for(var n=this,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return invoke((function(){return n.method(e,t).apply(void 0,i)}))},toJson:function(){return toJson(this.rule)},trigger:function(e,t){for(var n=this.el(e),r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];n&&n.$emit.apply(n,[t].concat(i))},el:function(t){var n=e.getCtx(t);if(n)return n.el||e.vm.$refs[n.ref]},closeModal:function(e){var t=a.el(e);t&&t.$emit&&t.$emit("close-modal")},validate:function(t){var n,r=this,i=!1,o=_objectSpread2(_objectSpread2({},{___this:{validate:function(t){e.$manager.validate((function(e){t&&t(e)}))}}}),e.subForm),a=Object.keys(o).filter((function(e){var t=o[e];return Array.isArray(t)?t.length:!is.Undef(t)})),u=a.length,c=function(e,o){e?n>1?n--:u>1?u--:t(!0):(i||(t(!1),i=!0),o&&r.clearValidateState(o,!1))};a.forEach((function(e){var t=o[e];Array.isArray(t)?(n=t.length,t.forEach((function(t){t.validate((function(t){return c(t,e)}))}))):t&&(n=1,t.validate(c))}))},validateField:function(t,n){e.fieldList[t]&&e.$manager.validateField(t,n)},resetFields:function(r){var i=e.fieldList;t(r).forEach((function(t){var r=i[t];r&&(e.$render.clearCache(r),r.rule.value=n(r.defaultValue),e.refreshControl(r))}))},submit:function(t,n){var r=this;this.validate((function(i){if(i){var o=r.formData();is.Function(t)?t(o,r):(is.Function(e.options.onSubmit)&&invoke((function(){return e.options.onSubmit(o,r)})),e.vm.$emit("submit",o,r))}else is.Function(n)&&invoke((function(){return n(r)}))}))},clearValidateState:function(n){var r=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t(n).forEach((function(t){i&&r.clearSubValidateState(t);var n=e.fieldList[t];n&&e.$manager.clearValidateState(n)}))},clearSubValidateState:function(n){t(n).forEach((function(t){var n=e.subForm[t];n&&(Array.isArray(n)?n.forEach((function(e){e.clearValidateState()})):n&&n.clearValidateState())}))},getSubForm:function(t){return e.subForm[t]},btn:{loading:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.submitBtnProps({loading:!!e})},disabled:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.submitBtnProps({disabled:!!e})},show:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.submitBtnProps({show:!!e})}},resetBtn:{loading:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.resetBtnProps({loading:!!e})},disabled:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.resetBtnProps({disabled:!!e})},show:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.resetBtnProps({show:!!e})}},nextTick:function(t){e.bus.$once("next-tick",t),e.refresh()}};return["on","once","off","set"].forEach((function(t){a[t]=function(){var n;(n=e.vm)["$".concat(t)].apply(n,arguments)}})),a.changeValue=a.changeField=a.setValue,a}function useCache(e){extend(e.prototype,{initCache:function(){this.clearCacheAll()},clearCache:function(e){if(this.cache[e.id]){(!0===this.cache[e.id].use||this.cache[e.id].parent)&&this.$handle.refresh();var t=this.cache[e.id].parent;this.cache[e.id]=null,t&&this.clearCache(t)}else e.parent&&this.clearCache(e.parent)},clearCacheAll:function(){this.cache={}},setCache:function(e,t,n){this.cache[e.id]={vnode:t,use:!1,parent:n}},getCache:function(e){var t=this.cache[e.id];return t.use=!0,t.vnode}})}function toCase(e){return e.replace(/(-[a-z])/g,(function(e){return e.replace("-","").toLocaleUpperCase()}))}function setTempProps(e,t,n){if(e.$props){var r=t.prop,i=Object.keys(e.$props),o=injectProp(t,n),a=Object.keys(o);i.forEach((function(t){hasProperty(r.props,t)?e.$props[t]=r.props[t]:a.indexOf(t)>-1&&(e.$props[t]=o[t])}));var u=e.$options.model&&e.$options.model.prop||"value";i.indexOf(u)>-1&&(e.$props[u]=r.value)}}function injectProp(e,t){return{formCreate:t,formCreateField:e.field,formCreateOptions:e.rule.options,formCreateRule:(n=_objectSpread2({},e.prop),n.on=n.on?_objectSpread2({},n.on):{},n)};var n}function useRender(e){extend(e.prototype,{initRender:function(){this.renderList={},this.clearOrgChildren()},initOrgChildren:function(){var e=this.$handle.ctxs;this.orgChildren=Object.keys(e).reduce((function(t,n){var r=e[n].rule.children;return t[n]=is.trueArray(r)?_toConsumableArray(r):[],t}),{})},clearOrgChildren:function(){this.orgChildren={}},render:function(){var e=this;if(this.vm.isShow){this.$manager.beforeRender();var t=this.sortList.map((function(t){return e.renderCtx(e.$handle.ctxs[t])})).filter((function(e){return void 0!==e}));return this.$manager.render(t)}},makeVm:function(e){var t=this,n=e.vm;return n?is.Function(n)?invoke((function(){return n(t.$handle.getInjectData(e))})):n._isVue?n:new _vue(n):new _vue},mergeGlobal:function(e){var t=this.$handle.options.global;t&&(e.cacheConfig||(e.cacheConfig=t[e.originType]||t[e.type]||t[e.trueType]||{}),e.prop=mergeProps([t["*"],e.cacheConfig,e.prop]))},renderTemp:function(e){var t=this;if(!_vue.compile)return tip("当前使用的Vue构建版本不支持compile,无法使用template功能"),[];var n=e.prop,r=e.id,i=e.key;if(!this.renderList[r]){e.el||(e.el=this.makeVm(n),this.vm.$nextTick((function(){return e.parser.mounted(e)})));var o=e.el;e.input&&o.$on(o.$options.model&&o.$options.model.event||"input",(function(n){t.onInput(e,n)})),this.renderList[r]={vm:o,template:_vue.compile(n.template)}}var a=this.renderList[r],u=a.vm,c=a.template;setTempProps(u,e,this.$handle.api);var s=c.render.call(u);return is.Undef(s.data)&&(s.data={}),s.key=i,s.data.ref=e.ref,s.data.key=i,s},renderAround:function(e,t){var n=t.prop;return[n.prefix||void 0,e,n.suffix||void 0]},renderCtx:function(e,t){if("hidden"!==e.type){if(!this.cache[e.id]||"template"===e.type){e.initProp(),this.mergeGlobal(e),this.$manager.tidyRule(e),this.ctxProp(e);var n,r=e.type,i=e.prop;if(i.hidden)return;var o=!e.input&&is.Undef(i.native);return n="template"===r&&i.template?this.renderTemp(e):e.parser.render(this.renderChildren(e),e),n=this.renderAround(n,e),o||!0===i.native||(n=this.$manager.makeWrap(e,n)),this.setCache(e,n,t),n}return this.getCache(e)}},ctxProp:function(e,t){var n=this,r=e.ref,i=e.key;this.$manager.mergeProp(e,t),e.parser.mergeProp(e,t);var o=[{props:injectProp(e,this.$handle.api),ref:r,key:"".concat(i,"fc")}];return t||o.push({on:{"hook:mounted":function(){n.onMounted(e)},"fc.sub-form":function(t){n.$handle.addSubForm(e,t)}},model:e.input?{value:this.$handle.getFormData(e),callback:function(t){n.onInput(e,t)},expression:"formData.".concat(e.field)}:void 0}),mergeProps(o,e.prop),e.prop},onMounted:function(e){e.el=this.vm.$refs[e.ref],e.parser.mounted(e),this.$handle.effect(e,"mounted")},onInput:function(e,t){this.$handle.onInput(e,t)},renderChildren:function(e){var t=this,n=e.rule.children,r=this.orgChildren[e.id];return!is.trueArray(n)&&r?(r.forEach((function(e){!is.String(e)&&e.__fc__&&t.$handle.rmCtx(e.__fc__)})),this.orgChildren[e.id]=[],[]):(r&&r.forEach((function(e){-1===n.indexOf(e)&&!is.String(e)&&e.__fc__&&t.$handle.rmCtx(e.__fc__)})),n.map((function(r){return is.String(r)?r:r.__fc__?t.renderCtx(r.__fc__,e):void(!t.$handle.isRepeatRule(r.__origin__||r)&&r.type&&t.vm.$nextTick((function(){t.$handle.loadChildren(n,e),t.$handle.refresh()})))})))},defaultRender:function(e,t){var n=e.prop;return this.vNode[e.type]?this.vNode[e.type](n,t):this.vNode[e.originType]?this.vNode[e.originType](n,t):this.vNode.make(e.originType,n,t)},renderRule:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=toCase(e.type),r=this.vNode.aliasMap[n];return r&&(n=toCase(r)),this.vm.$createElement(n,e,t)}})}function Render(e){extend(this,{$handle:e,fc:e.fc,vm:e.vm,$manager:e.$manager,vNode:new e.fc.CreateNode(e.vm)}),funcProxy(this,{options:function(){return e.options},sortList:function(){return e.sortList}}),this.initCache(),this.initRender()}function useInject(e){extend(e.prototype,{parseInjectEvent:function(e,t){var n=this;if(!1!==e.inject){var r=e.inject||this.options.injectEvent;if(!is.Undef(r))return Object.keys(t).forEach((function(i){is.Function(t[i])&&(t[i]=n.inject(e,t[i],r))})),t}},parseEmit:function(e,t){var n=this,r={},i=e.rule,o=i.emitPrefix,a=i.field,u=i.name,c=i.inject,s=i[t?"emit":"nativeEmit"]||[];if(is.trueArray(s)){var f=o||a||u;f&&(t||(f="native-".concat(f)),s.forEach((function(e){if(e){var t=toLine("".concat(f,"-").concat(e)),o=function(){for(var e,r,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];(e=n.vm).$emit.apply(e,[t].concat(o)),(r=n.vm).$emit.apply(r,["emit-event",t].concat(o))};o.__emit=!0,!1===c?r[e]=o:(c=i.inject||n.options.injectEvent,r[e]=is.Undef(c)?o:n.inject(i,o,c))}})))}return e.computed[t?"on":"nativeOn"]=r,r},getInjectData:function(e,t){var n=this.vm.$options.propsData,r=n.option,i=n.rule;return{$f:this.api,rule:i,self:e.__origin__,option:r,inject:t}},inject:function(e,t,n){if(t.__inject){if(this.watching)return t;t=t.__origin}var r=this,i=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return o.unshift(r.getInjectData(e,n)),t.apply(this,o)};return i.__inject=!0,i.__origin=t,i}})}function usePage(e){extend(e.prototype,{usePage:function(){var e=this,t=this.options.page;if(t){var n=25,r=getLimit(this.rules);is.Object(t)&&(t.first&&(n=parseInt(t.first,10)||n),t.limit&&(r=parseInt(t.limit,10)||r)),extend(this,{first:n,limit:r,pageEnd:this.rules.length<=n}),this.bus.$on("page-end",(function(){return e.vm.$emit("page-end",e.api)})),this.pageLoad()}},pageLoad:function(){var e=this;this.vm.$on("hook:updated",(function t(){e.pageEnd?(e.vm.$off("hook:updated",t),e.bus.$emit("page-end")):(e.first+=e.limit,e.pageEnd=e.rules.length<=e.first,e.loadRule(),e.refresh())}))}})}function getLimit(e){return e.length<31?31:Math.ceil(e.length/3)}function useRender$1(e){extend(e.prototype,{clearNextTick:function(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick:function(e){var t=this;this.clearNextTick(),this.nextTick=setTimeout((function(){e(),t.nextTick=null}),10)},render:function(){return console.warn("%c render","color:green"),++this.loadedId,this.vm.unique>0?this.$render.render():(this.vm.unique=1,[])}})}function bind(e){Object.defineProperties(e.origin,{__fc__:enumerable(e,!0)})}function RuleContext(e,t){var n=uniqueId();extend(this,{id:n,ref:n,wrapRef:n+"fi",rule:t,origin:t.__origin__||t,name:t.name,watch:[],linkOn:[],root:[],ctrlRule:[],parent:null,cacheConfig:null,prop:{},computed:{},input:!!t.field,el:void 0,defaultValue:t.field?deepCopy(t.value):void 0,field:t.field||void 0}),this.updateType(),this.updateKey(),bind(this),this.update(e,!0)}function useLoader(e){extend(e.prototype,{nextLoad:function(){var e=this,t=this.loadedId;this.vm.$nextTick((function(){t===e.loadedId&&e.refresh()}))},parseRule:function(e){var t=this,n=getRule(e);return Object.defineProperties(n,{__origin__:enumerable(e,!0)}),fullRule(n),n.field&&hasProperty(this.options.formData||{},n.field)&&(n.value=this.options.formData[n.field]),n.options=parseArray(n.options),this.ruleEffect(n,"init"),["on","props","nativeOn"].forEach((function(e){t.parseInjectEvent(n,n[e]||{})})),n},isRepeatRule:function(e){return this.repeatRule.indexOf(e)>-1},loadRule:function(){if(console.warn("%c load","color:blue"),this.cycleLoad=!1,this.pageEnd&&this.bus.$emit("load-start"),this._loadRule(this.rules),this.cycleLoad&&this.pageEnd)return this.loadRule();this.pageEnd&&this.bus.$emit("load-end"),this.vm._renderRule(),this.$render.initOrgChildren(),this.syncForm()},loadChildren:function(e,t){if(this.cycleLoad=!1,this.bus.$emit("load-start"),this._loadRule(e,t),this.cycleLoad)return this.loadRule();this.$render.clearCache(t)},_loadRule:function(e,t){var n=this,r=function(e,t){is.trueArray(e)&&n._loadRule(e,t)};e.map((function(i,o){if((!t||!is.String(i))&&(n.pageEnd||t||!(o>=n.first))){if(!is.Object(i)||!getRule(i).type)return err("未定义生成规则的 type 字段",i);if(i.__fc__&&i.__fc__.root===e&&n.ctxs[i.__fc__.id])return r(i.__fc__.rule.children,i.__fc__),i.__fc__;var a,u=getRule(i);if(u.field&&n.fieldList[u.field])return n.repeatRule.push(i),err("".concat(u.field," 字段已存在"),i);if(i.__fc__)if((a=i.__fc__).deleted){if(!a.check(n)){if(a.rule.__ctrl)return;a.update(n)}}else if(!a.check(n)||n.ctxs[a.id]){if(a.rule.__ctrl)return;e[o]=i=i._clone?i._clone():copyRule(i),a=null}if(a?a.originType!==a.rule.type&&(a.updateType(),n.bindParser(a)):(a=new RuleContext(n,n.parseRule(i)),n.bindParser(a)),n.appendValue(a.rule),[!1,!0].forEach((function(e){return n.parseEmit(a,e)})),a.parent=t||null,a.root=e,n.setCtx(a),r(a.rule.children,a),!t){var c=function t(r){var i=e[r-1];if(!i||!i.__fc__)return r>0?t(r-1):-1;var o=n.sortList.indexOf(i.__fc__.id);return o>-1?o:t(r-1)}(o);c>-1?n.sortList.splice(c+1,0,a.id):n.sortList.push(a.id)}var s=a.rule;return a.updated||(a.updated=!0,is.Function(s.update)&&n.bus.$once("load-end",(function(){n.refreshUpdate(a,s.value)}))),a.input&&Object.defineProperty(s,"value",n.valueHandle(a)),n.effect(a,"loaded"),n.refreshControl(a)&&(n.cycleLoad=!0),a}}))},refreshControl:function(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl:function(e){var t=this,n=getCtrl(e),r=[],i=this.api;if(!n.length)return!1;for(var o=function(t){var o=n[t],a=o.handle||function(e){return e===o.value},u=_objectSpread2(_objectSpread2({},o),{},{valid:invoke((function(){return a(e.rule.value,i)})),ctrl:findCtrl(e,o.rule)});if(u.valid&&u.ctrl||!u.valid&&!u.ctrl)return"continue";r.push(u)},a=0;a<n.length;a++)o(a);if(!r.length)return!1;var u=!1;return r.reverse().forEach((function(n){var r=n.valid,o=n.rule,a=n.prepend,c=n.append,s=n.child,f=n.ctrl;if(r){u=!0;var l={type:"fcFragment",native:!0,__ctrl:!0,children:o};e.ctrlRule.push(l),t.bus.$once("load-start",(function(){a?i.prepend(l,a,s):c||s?i.append(l,c||e.id,s):e.root.splice(e.root.indexOf(e.origin)+1,0,l)}))}else{e.ctrlRule.splice(e.ctrlRule.indexOf(f),1);var d=byCtx(f);d&&d.rm()}})),this.vm.$emit("control",e.origin,this.api),this.effect(e,"control"),u},reloadRule:debounce((function(e){return this._reloadRule(e)}),1),_reloadRule:function(e){var t=this;console.warn("%c reload","color:red"),e||(e=this.rules);var n=_objectSpread2({},this.ctxs);this.clearNextTick(),this.$render.clearOrgChildren(),this.initData(e),this.bus.$once("load-end",(function(){Object.keys(n).filter((function(e){return void 0===t.ctxs[e]})).forEach((function(e){return t.rmCtx(n[e],!0)})),t.$render.clearCacheAll()})),this.loadRule(),this.refresh(),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload)},refresh:function(){this.vm._refresh()}})}function parseArray(e){return Array.isArray(e)?e:[]}function fullRule(e){var t=baseRule();return Object.keys(t).forEach((function(n){hasProperty(e,n)||$set(e,n,t[n])})),e}function getCtrl(e){var t=e.rule.control||[];return is.Object(t)?[t]:t}function findCtrl(e,t){for(var n=0;n<e.ctrlRule.length;n++){var r=e.ctrlRule[n];if(r.children===t)return r}}function useInput(e){extend(e.prototype,{getValue:function(e){return hasProperty(e,"cacheValue")||(e.cacheValue=e.parser.toValue(this.getFormData(e),e)),e.cacheValue},setValue:function(e,t,n,r){e.cacheValue=t,this.changeStatus=!0,this.nextLoad(),this.$render.clearCache(e),this.setFormData(e,n),this.syncValue(),this.valueChange(e,t),this.vm.$emit("change",e.field,t,e.origin,this.api,r),this.effect(e,"value")},onInput:function(e,t){var n;e.input&&(this.isQuote(e,n=e.parser.toValue(t,e))||this.isChange(e,n))&&this.setValue(e,n,t)},setFormData:function(e,t){$set(this.formData,e.field,t)},getFormData:function(e){return this.formData[e.field]},syncForm:function(){var e=this;Object.keys(this.form).forEach((function(t){return delete e.form[t]})),Object.defineProperties(this.form,Object.keys(this.formData).reduce((function(t,n){var r=e.getCtx(n),i=e.valueHandle(r);return i.configurable=!0,t[n]=i,t}),{})),this.syncValue()},valueHandle:function(e){var t=this;return{enumerable:!0,get:function(){return t.getValue(e)},set:function(n){t.isChange(e,n)&&t.setValue(e,n,e.parser.toFormValue(n,e),!0)}}},appendValue:function(e){e.field&&hasProperty(this.appendData,e.field)&&(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm:function(e,t){this.subForm[e.field]=t},syncValue:function(){this.vm._updateValue(_objectSpread2({},this.form))},isChange:function(e,t){return JSON.stringify(e.rule.value)!==JSON.stringify(t)},isQuote:function(e,t){return(is.Object(t)||Array.isArray(t))&&t===e.rule.value},refreshUpdate:function(e,t){var n=this,r=e.rule.update;if(is.Function(r)){var i=invoke((function(){return r(t,e.origin,n.api)}));if(void 0===i)return;e.rule.hidden=!0===i}},valueChange:function(e,t){this.refreshRule(e,t),this.bus.$emit("change-"+e.field,t)},refreshRule:function(e,t){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.refresh()),this.refreshUpdate(e,t)},appendLink:function(e){var t=this,n=e.rule.link;is.trueArray(n)&&n.forEach((function(n){var r=function(){return t.refreshRule(e,e.rule.value)};t.bus.$on("change-"+n,r),e.linkOn.push((function(){return t.bus.$off("change-"+n,r)}))}))},fields:function(){return Object.keys(this.formData)}})}function useHelper(e){Array.isArray(e)&&!e.findField&&Object.defineProperties(e,{findField:enumerable(findField),findName:enumerable(findName),setValue:enumerable(setValue)})}function find(e,t,n){if(this.length){for(var r=[],i=0;i<this.length;i++)if(is.Object(this[i])){var o=getRule(this[i]);if(o[t]===e)return n?o:this[i];is.trueArray(o.children)&&(r=r.concat(o.children)),is.trueArray(o.control)&&o.control.forEach((function(e){r=r.concat(e.rule)}))}return find.call(r,e,t,n)}}function findField(e){return find.call(this,e,"field")}function findName(e){return find.call(this,e,"name")}function setValue(e){var t=this;Object.keys(e).forEach((function(n){var r=find.call(t,n,"field",!0);r&&(r.value=e[n])}))}useCache(Render),useRender(Render),extend(RuleContext.prototype,{updateKey:function(e){this.key=uniqueId(),e&&this.parent&&this.parent.updateKey(parent)},updateType:function(){this.originType=this.rule.type,this.type=toCase(this.rule.type)},setParser:function(e){this.parser=e,e.init(this)},initProp:function(){this.prop=mergeProps([this.rule,this.computed])},check:function(e){return this.vm===e.vm},unwatch:function(){this.watch.forEach((function(e){return e()})),this.watch=[]},unlink:function(){this.linkOn.forEach((function(e){return e()})),this.linkOn=[]},link:function(){this.unlink(),this.$handle.appendLink(this)},watchTo:function(){this.$handle.watchCtx(this)},delete:function(){this.unwatch(),this.unlink(),this.rmCtrl(),extend(this,{deleted:!0,prop:{},computed:{},el:void 0,$handle:void 0,$render:void 0,vm:void 0,vNode:void 0,parent:null,cacheConfig:null})},rmCtrl:function(){this.ctrlRule.forEach((function(e){return e.__fc__.rm()})),this.ctrlRule=[]},rm:function(){var e=this.root.indexOf(this.origin);-1!==e&&(this.root.splice(e,1),this.rmCtrl(),this.$handle.rmCtx(this),extend(this,{root:[]}))},update:function(e,t){extend(this,{deleted:!1,$handle:e,$render:e.$render,vm:e.vm,trueType:e.getType(this.originType),vNode:e.$render.vNode,updated:!1}),!t&&this.unwatch(),this.watchTo(),this.link()}});var BaseParser={init:function(e){},toFormValue:function(e,t){return e},toValue:function(e,t){return e},mounted:function(e){},render:function(e,t){return t.$render.defaultRender(t,e)},mergeProp:function(e){}};function useContext(e){extend(e.prototype,{getCtx:function(e){return this.fieldList[e]||this.customData[e]||this.ctxs[e]},setCtx:function(e){var t=e.id,n=e.field,r=e.name,i=e.rule;this.ctxs[t]=e,r&&$set(this.customData,r,e),e.input&&(this.fieldList[n]=e,$set(this.formData,n,e.parser.toFormValue(i.value,e)),$set(this.validate,n,i.validate||[]))},getParser:function(e){var t=this.fc.parsers;return t[e.originType]||t[toCase(e.type)]||t[e.trueType]||BaseParser},bindParser:function(e){e.setParser(this.getParser(e))},getType:function(e){var t=this.fc.CreateNode.aliasMap,n=t[e]||t[toCase(e)]||e;return toCase(n)},watchCtx:function(e){var t=this,n=this.vm,r=["field","value","vm","template","name","config","control","inject"];Object.keys(e.rule).filter((function(e){return-1===r.indexOf(e)})).forEach((function(r){e.watch.push(n.$watch((function(){return e.rule[r]}),(function(n){if(t.watching=!0,"hidden"===r)e.updateKey(!0);else{if("link"===r)return void e.link();if("validate"===r){if(!e.input)return;t.validate[e.field]=n||[]}else["props","on","nativeOn"].indexOf(r)>-1?t.parseInjectEvent(e.rule,n||{}):["emit","nativeEmit"].indexOf(r)>-1?t.parseEmit(e,"emit"===r):"type"===r?(e.updateType(),t.bindParser(e)):"children"===r&&t.loadChildren(n,e)}t.$render.clearCache(e),t.watching=!1}),{deep:"children"!==r}))})),this.watchEffect(e)},rmCtx:function(e,t){this._rmCtx(e),t||(this.$render.initOrgChildren(),this.syncValue())},_rmCtx:function(e){var t=this;if(!e.deleted){var n=e.id,r=e.field,i=e.name;e.input&&Object.defineProperty(e.rule,"value",{value:e.rule.value,writable:!0}),is.trueArray(e.rule.children)&&e.rule.children.forEach((function(e){return e.__fc__&&t._rmCtx(e.__fc__)})),$del(this.ctxs,n),$del(this.validate,r),$del(this.formData,r),$del(this.form,r),$del(this.fieldList,r),$del(this.$render.renderList,n),$del(this.customData,i),$del(this.subForm,r),$del(e,"cacheValue");var o=this.sortList.indexOf(n);return o>-1&&this.sortList.splice(o,1),e.delete(),this.effect(e,"deleted"),e}}})}function useLifecycle(e){extend(e.prototype,{mounted:function(){var e=this,t=function(){e.isMounted=!0,e.lifecycle("mounted")};this.pageEnd?t():this.bus.$once("page-end",t)},lifecycle:function(e){var t=this,n=this.options[e];is.Function(n)&&invoke((function(){return n(t.api)})),this.vm.$emit(e,this.api)}})}function useEffect(e){extend(e.prototype,{useProvider:function(){var e=this,t=this.fc.providers;Object.keys(t).forEach((function(n){var r=t[n];r._c=getComponent(r),e.onEffect(r),e.providers[n]=r}))},onEffect:function(e){var t=this,n=[];(e._c||["*"]).forEach((function(r){var i="*"===r?"*":t.getType(r);n.indexOf(i)>-1||(n.push(i),t.bus.$on("p:".concat(e.attr,":").concat(i,":").concat(e.input?1:0),(function(t,n){e[t]&&e[t].apply(e,_toConsumableArray(n))})))})),e._used=n},watchEffect:function(e){var t=this,n=this.vm;Object.keys(e.rule.effect||{}).forEach((function(r){e.watch.push(n.$watch((function(){return e.rule.effect[r]}),(function(n){t.effect(e,"watch",_defineProperty({},r,n))})))}))},effect:function(e,t,n){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,custom:n},t)},ruleEffect:function(e,t){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},t)},emitEffect:function(e,t){var n=this,r=e.rule,i=e.input,o=e.type,a=e.custom;if(o&&"fcFragment"!==o){var u=a||(r.effect||{});Object.keys(u).forEach((function(e){var a=n.providers[e];if(a&&(!a.input||i)){var c;if(a._c){if(!(a._used.indexOf(o)>-1))return;c=o}else c="*";n.bus.$emit("p:".concat(e,":").concat(c,":").concat(a.input?1:0),t,[u[e],r,n.api])}}))}}})}function unique(e){return e.filter((function(e,t,n){return n.indexOf(e,0)===t}))}function getComponent(e){var t=e.components;return Array.isArray(t)?unique(t.filter((function(e){return"*"!==e}))):!!is.String(t)&&[t]}function Handler(e){var t=this;extend(this,{fc:e,vm:e.vm,watching:!1,isMounted:!1,validate:{},formData:{},subForm:{},form:{},appendData:{},providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:function(){t.lifecycle("reload")}}),funcProxy(this,{options:function(){return e.options},bus:function(){return e.bus}}),this.initData(e.rules),this.$manager=new e.manager(this),this.$render=new Render(this),this.api=Api(this)}extend(Handler.prototype,{initData:function(e){extend(this,{fieldList:{},ctxs:{},customData:{},sortList:[],rules:e,repeatRule:[]}),useHelper(e)},init:function(){this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init(),this.vm.$set(this.vm,"formData",this.formData)}}),useInject(Handler),usePage(Handler),useRender$1(Handler),useLoader(Handler),useInput(Handler),useContext(Handler),useLifecycle(Handler),useEffect(Handler);var NAME$1="fcFragment",fragment={name:NAME$1,functional:!0,render:function(e,t){return t.children}};function parseProp(e){return is.String(e)?{domProps:{innerHTML:e}}:e}function CreateNodeFactory(){var e={};function t(e){e&&this.setVm(e)}return extend(t.prototype,{setVm:function(e){this.vm=e,this.$h=e.$createElement},make:function(e,t,n){var r=this.$h(e,parseProp(t),n||[]);return r.context=this.vm,r},aliasMap:e}),extend(t,{aliasMap:e,alias:function(t,n){e[t]=n},use:function(e){Object.keys(e).forEach((function(n){var r=toLine(n),i=toString(n).toLocaleLowerCase(),o=e[n];[n,r,i].forEach((function(e){t.alias(n,o),t.prototype[e]=function(e,t){return this.make(o,e,t)}}))}))}}),t}function createManager(e){var t=function(e){_inherits(n,Manager);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}();return Object.assign(t.prototype,e),t}function Manager(e){extend(this,{$handle:e,vm:e.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}extend(Manager.prototype,{__init:function(){this.$render=this.$handle.$render},updateKey:function(){this.key=uniqueId()},init:function(){},update:function(){},beforeRender:function(){},form:function(){return this.vm.$refs[this.ref]},mergeOptions:function(e,t){var n=this;return mergeProps(e.map((function(e){return n.tidyOptions(e)})),t,this.mergeOptionsRule)},updateOptions:function(e){this.options=this.mergeOptions([e],this.getDefaultOptions()),this.update()},tidyOptions:function(e){return e},tidyRule:function(e){},mergeProp:function(e){},getDefaultOptions:function(){return{}},render:function(e){}});var _vue="undefined"!=typeof window&&window.Vue?window.Vue:Vue;function _parseProp(e,t){var n;return 2===arguments.length?t=(n=arguments[1])[e]:n=arguments[2],{id:t,prop:n}}function nameProp(){return _parseProp.apply(void 0,["name"].concat(Array.prototype.slice.call(arguments)))}function _getEl(e){return e&&e.el?is.Element(e.el)?e.el:document.querySelector(e.el):window.document.body}function mountForm(e,t){var n=new _vue({data:function(){return{rule:e,option:t||{}}},render:function(e){return e("FormCreate",{ref:"fc",props:this.$data})}});return n.$mount(),n}function FormCreateFactory(e){var t=_defineProperty({},fragment.name,fragment),n={},r={},i={},o={},a=makerFactory(),u={global:{}},c={},s=CreateNodeFactory();function f(){var e=nameProp.apply(void 0,arguments);e.id&&e.prop&&(n[e.id]=e.prop)}function l(){var e=nameProp.apply(void 0,arguments);e.id&&e.prop&&(i[e.id]=e.prop)}function d(){var e=_parseProp.apply(void 0,["attr"].concat(Array.prototype.slice.call(arguments)));e.id&&e.prop&&(o[e.id]=_objectSpread2(_objectSpread2({},e.prop),{},{attr:e.id}))}function p(e){s.use(e)}function h(){var e=nameProp.apply(void 0,arguments);if(e.id&&e.prop){var t=toCase(e.id),n=e.prop;r[t]=_objectSpread2(_objectSpread2({},BaseParser),n),a[t]=creatorFactory(t),n.maker&&extend(a,n.maker)}}function m(e,n){var r;if(is.String(e)){if(r=toCase(e),["form-create","formcreate"].indexOf(r)>-1)return v();if(void 0===n)return t[r]}else r=toCase(e.name),n=e;r&&n&&(t[r]=n,n.formCreateParser&&h(r,n.formCreateParser))}function v(){return _vue.extend($FormCreate(_))}function y(e){return is.Function(e.install)?e.install(g):is.Function(e)&&e(g),this}function g(e,t,n){var r=mountForm(e,t||{}),i=r.$refs.fc.formCreate;return i.$parent=n,_getEl(i.options).appendChild(r.$el),i.api()}function _(a,u,c){extend(this,{vm:a,manager:createManager(e.manager),parsers:r,providers:o,rules:Array.isArray(u)?u:[],prop:{components:t,filters:n,directives:i},CreateNode:s,bus:new _vue}),this.init(),this.initOptions(c||{})}function b(t){extend(t,{version:e.version,ui:e.ui,data:c,maker:a,component:m,filter:f,directive:l,register:d,parser:h,use:y,componentAlias:p,copyRule:copyRule,copyRules:copyRules,$form:v,parseJson:parseJson})}return extend(_.prototype,{init:function(){var e=this,t=this.vm,n=new Handler(this);this.$handle=n,t.$f=n.api,t.$emit("input",n.api),t.$on("hook:created",(function(){e.created()})),t.$on("hook:mounted",(function(){e.mounted()})),t.$on("hook:beforeDestroy",(function(){n.reloadRule([])})),t.$on("hook:updated",(function(){n.bindNextTick((function(){return e.bus.$emit("next-tick",n.api)}))}))},initOptions:function(e){this.options=_objectSpread2({formData:{}},u),this.updateOptions(e)},updateOptions:function(e){e.global&&(this.options.global=mergeGlobal(this.options.global,e.global)),this.$handle.$manager.mergeOptions([e],this.options),this.$handle.$manager.updateOptions(this.options)},created:function(){this.$handle.init()},api:function(){return this.$handle.api},render:function(){return this.$handle.render()},mounted:function(){this.$handle.mounted()}}),b(g),function(e){extend(e,{create:g,install:function(e,t){if(u=_objectSpread2(_objectSpread2({},u),t||{}),!0!==e._installedFormCreate){e._installedFormCreate=!0,_vue=e;var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return g(e,t,this)};b(n),e.prototype.$formCreate=n,e.component("FormCreate",v())}},init:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=mountForm(e,t),r=n.$refs.fc.formCreate;return{mount:function(e){return e&&is.Element(e)&&(r.options.el=e),_getEl(r.options).appendChild(n.$el),r.api()},remove:function(){n.$el.parentNode&&n.$el.parentNode.removeChild(n.$el)},destroy:function(){this.remove(),n.$destroy()},$f:r.api()}}})}(g),s.use({fragment:"fcFragment"}),e.install&&g.use(e),g}export default FormCreateFactory;export{Creator,Manager,copyRule,copyRules,creatorFactory,creatorTypeFactory,mergeRule,parseJson,toJson};
//# sourceMappingURL=form-create.core.min.js.map
